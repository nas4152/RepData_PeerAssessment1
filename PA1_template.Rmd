---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

First, the dataset is unzipped if the csv file is not present.  Then the data
is stored in a variable called fitdata.  The date column is converted from a 
factor to a date class.

```{r}
if (!file.exists("activity.csv")){
        unzip("activity.zip")
}
fitdata <- read.csv("activity.csv")
fitdata$date <- as.Date(fitdata$date, "%Y-%m-%d")
```

## What is mean total number of steps taken per day?

First totals were calculated of the steps variable by date, ignoring missing 
values, and stored into the sums variable.  A histogram of the totals was 
created.

```{r}
sums <- aggregate(fitdata$steps, by = list(fitdata$date), sum, na.rm = TRUE)

library(ggplot2)
ggplot(sums, aes(x)) + 
        geom_histogram(bins = 10, col = "grey", fill = "steelblue") +
        labs(title = "Total Steps per Day") +
        labs(x = "Total Steps") +
        labs(y = "Number of Days")
```

Then the mean and medians are calculated.

```{r}
mean(sums[ ,2])
median(sums[ ,2])
```

## What is the average daily activity pattern?

First the mean number of steps across all days for each time interval were 
calculated.  This was plotted against the 5-min intervals to show the average 
change in activity over the course of a day.

```{r}
means <- aggregate(fitdata$steps, list(fitdata$interval), mean, na.rm = TRUE)
colnames(means) <- c("Interval", "Steps")
ggplot(means) +
        geom_line(aes(Interval, Steps),col = "indianred") +
        labs(y = "Average Number of Steps") + 
        labs(x = "5-minute Interval") +
        labs(title = "Average Daily Activity")
```

The maximum average step value was calculated and the associated interval
reported.

```{r}
stepmax <- max(means$Steps)
means$Interval[means$Steps == stepmax]
```

## Imputing missing values

The number of missing values is calculated.
```{r}
sum(is.na(fitdata$steps))
```

I chose to replace missing values with the mean number of steps at that time 
interval. First the data was split by interval, then missing values were 
replaced with the column mean.  (The function na.gam.replace replaces missing 
value with a funcion of the column, with mean being the default)

```{r}
library(gam)
filldata <- split(fitdata, fitdata$interval)
filldata <- lapply(filldata, na.gam.replace)
filldata <- unsplit(filldata, fitdata$interval)

```

Analysis from the mean total was re-run to examine the effects of replacing
missing values on the totals. 

```{r}
fillsums <- aggregate(filldata$steps, by = list(filldata$date), sum, na.rm = TRUE)
ggplot(fillsums, aes(x)) + 
        geom_histogram(bins = 10, col = "grey", fill = "steelblue") +
        labs(title = "Total Steps per Day") +
        labs(x = "Total Steps") +
        labs(y = "Number of Days")
```

Then the mean and medians are calculated.

```{r}
mean(fillsums[ ,2])
median(fillsums[ ,2])
```

Because missing values were omitted previously, replacing missing values 
increased the total steps for every day in which missing values were present.

## Are there differences in activity patterns between weekdays and weekends?

A function was created to determine if a date was a weekday or a weekend.
Then a column was added to the dataset with the results of applying the 
function to the date of the data.  
```{r}
weekend <- function(x) {
        ifelse(weekdays(x) == "Saturday"|weekdays(x) == "Sunday",
               "Weekend","Weekday")
}

library(dplyr)
filldata <- mutate(filldata, day = weekend(date))
filldata$day <- as.factor(filldata$day)
```

The means were calculated for each interval on the weekday and weekends, then
plotted.

```{r}
wmeans <- aggregate.data.frame(filldata$steps, list(filldata$interval, filldata$day), "mean")
colnames(wmeans) <- c("interval", "day", "steps")
ggplot(wmeans) +
        geom_line(aes(interval, steps, color = day)) +
        facet_wrap(~day, ncol = 1, nrow = 2) +
        guides(color = FALSE)
```

